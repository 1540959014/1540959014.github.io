<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°çŒ«æ‹¿é±¼</title>
    <style>
        :root {
            --rank-B: #95a5a6; --rank-A: #3498db; --rank-S: #2ecc71; --rank-SR: #9b59b6; --rank-SSR: #f1c40f; --rank-GOD: #ff4757;
            --ui-bg: rgba(15, 20, 25, 0.95);
            --card-bg: #161b22;
            --accent: #e67e22;
            --border-color: #30363d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: #020508; height: 100vh; font-family: 'PingFang SC', sans-serif; color: #fff; overflow: hidden; user-select: none; }



          /* --- æ ¸å¿ƒåŠ¨ç”»åº“ (æœ€ç»ˆä¿®æ­£ç‰ˆ) --- */
        @keyframes float-icon { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes rotate-border { 100% { transform: rotate(360deg); } }
        @keyframes god-distort { 0% { filter: hue-rotate(0deg) brightness(1); } 50% { filter: hue-rotate(45deg) brightness(1.3); } 100% { filter: hue-rotate(0deg) brightness(1); } }
        @keyframes god-impact { 0% { opacity: 0; background: #fff; } 20% { opacity: 1; background: #fff; } 100% { opacity: 0; background: transparent; } }
        @keyframes screen-shake-light { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(1px, 0); } 50% { transform: translate(-1px, 0); } 75% { transform: translate(0, 1px); } }
        @keyframes screen-shake-heavy { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(4px,2px) rotate(0.1deg); } 50% { transform: translate(-3px,-2px) rotate(-0.1deg); } 75% { transform: translate(2px,-3px) rotate(0.1deg); } }

        /* 1. æŠ›ç«¿åŠ¨ç”»: å¢åŠ è“„åŠ›å›å¼¹ */
        @keyframes rod-cast-anim {
            0% { transform: rotate(-10deg); } /* åˆå§‹çŠ¶æ€ */
            30% { transform: rotate(25deg); } /* è“„åŠ›åæ‘† */
            100% { transform: rotate(-10deg); } /* å¿«é€Ÿç”©å‡ºåæ¢å¤ */
        }

        /* 2. å’¬é’©åŠ¨ç”»: é±¼ç«¿è¢«çŒ›çƒˆæ‹‰å¼¯ */
        @keyframes rod-bite-tension {
            0% { transform: rotate(-10deg); }
            100% { transform: rotate(-65deg); }
        }

        /* 3. æ”¶ç«¿åŠ¨ç”»: å‰§çƒˆææ–—ï¼Œå¼“å½¢æŠ–åŠ¨ */
        @keyframes rod-reel-in-fight {
            0% { transform: rotate(-70deg) translate(0, 0); }
            20% { transform: rotate(-75deg) translate(-2px, 2px); }
            40% { transform: rotate(-68deg) translate(2px, -2px); }
            60% { transform: rotate(-72deg) translate(-1px, 1px); }
            80% { transform: rotate(-69deg) translate(1px, -1px); }
            100% { transform: rotate(-10deg); } /* æœ€ç»ˆæ”¶å› */
        }
        
        @keyframes float-land-wobble {
            0% { transform: translate(140px, 120px) scale(1.1); }
            50% { transform: translate(140px, 122px) scale(0.95); }
            100% { transform: translate(140px, 120px) scale(1); }
        }


        /* --- ç‰¹æ•ˆå±‚ --- */
        #god-fx { position: fixed; inset: 0; z-index: 999; pointer-events: none; opacity: 0; }
        .god-flash-anim { animation: god-impact 1.2s ease-out forwards; }
        @keyframes god-impact { 0% { opacity: 0; background: #fff; } 20% { opacity: 1; background: #fff; } 100% { opacity: 0; background: transparent; } }

        .stage { width: 100%; height: 100%; max-width: 500px; margin: 0 auto; position: relative; overflow: hidden; background: radial-gradient(circle at 50% 40%, #1a2a33 0%, #020508 100%); }
        .stage.impact-shake { animation: screen-shake 0.2s cubic-bezier(.36,.07,.19,.97) both; }

        /* --- é¡¶éƒ¨ HUD --- */
        .header-group { position: absolute; top: 15px; width: 100%; padding: 0 15px; z-index: 100; pointer-events: none; }
        .hud { pointer-events: auto; background: var(--ui-bg); border: 1px solid var(--border-color); border-radius: 16px; display: flex; justify-content: center; gap: 20px; padding: 10px; backdrop-filter: blur(8px); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .hud-item { font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 6px; }
        .buff-tag { pointer-events: auto; width: fit-content; margin: 8px auto 0; background: rgba(241, 196, 15, 0.15); border: 1px solid var(--rank-SSR); color: var(--rank-SSR); font-size: 11px; padding: 4px 12px; border-radius: 20px; display: none; }

        /* --- ä¾§è¾¹èœå• --- */
        .settings-drawer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 800; transform: translateX(-100%); transition: 0.3s; backdrop-filter: blur(5px); display: flex; }
        .settings-content { width: 70%; background: #1c2128; height: 100%; padding: 30px 20px; border-right: 1px solid var(--rank-A); }
        .settings-drawer.active { transform: translateX(0); }
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #333; font-size: 14px; }

        /* --- æ¸¸æˆä¸»ç”»é¢ (åŠ¨ç”»é‡æ„) --- */
        .game-view { height: 50%; width: 100%; display: flex; align-items: center; justify-content: center; position: relative; }
                      /* --- çŒ«å’ªå®¹å™¨å®šä½è°ƒæ•´ --- */
               /* --- çŒ«å’ªå®¹å™¨ --- */
                /* --- å…¨å±€å®¹å™¨ --- */
        .cat-box {
            position: absolute;
            z-index: 10;
            width: 240px;
            height: 220px;
            bottom: 25px;
            left: 40%; 
            transform: translateX(-50%);
            /* åŸºç¡€å‘¼å¸åŠ¨ç”» */
            animation: cat-breath 4s ease-in-out infinite;
            /* ç¡®ä¿å˜æ¢å¹³æ»‘ */
            transition: transform 0.2s;
        }

        #hoodie-cat-svg { width: 100%; height: 100%; overflow: visible; }

        /* --- å…¨èº«åŠ¨ç”»çŠ¶æ€ (ç”±JSæ§åˆ¶å®¹å™¨class) --- */
        
        /* 1. æŠ›ç«¿çŠ¶æ€ï¼šèº«ä½“ç¨å¾®åä»°è“„åŠ›ï¼Œç„¶åå‰å€¾ */
        .cat-box.casting #cat-torso-group {
            animation: body-cast 0.5s cubic-bezier(0.5, 0, 0.1, 1);
            transform-origin: 100px 160px; /* ä»¥åº•éƒ¨ä¸ºæ”¯ç‚¹ */
        }
        .cat-box.casting #arm-and-rod-group {
            animation: rod-cast-anim 0.5s cubic-bezier(0.5, 0, 0.1, 1);
        }

        /* 2. å’¬é’©çŠ¶æ€ï¼šèº«ä½“éœ‡åŠ¨ */
        .cat-box.biting {
            animation: body-shock 0.2s infinite;
        }
        .cat-box.biting #arm-and-rod-group {
            animation: rod-bite-tension 0.2s forwards;
        }

        /* 3. æ”¶ç«¿çŠ¶æ€ï¼šèº«ä½“å¤§å¹…åä»° (æ‹”æ²³!) */
        .cat-box.reeling #cat-torso-group {
            animation: body-reel-back 0.7s forwards;
            transform-origin: 100px 160px;
        }
        .cat-box.reeling #arm-and-rod-group {
            animation: rod-reel-in-fight 0.7s forwards;
        }

        /* --- å…³é”®å¸§å®šä¹‰ --- */
        @keyframes cat-breath {
            0%, 100% { transform: translateX(-50%) translateY(0) scale(1); }
            50% { transform: translateX(-50%) translateY(-4px) scale(1.01); }
        }
        
        @keyframes body-cast {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(-10deg); } /* åä»°è“„åŠ› */
            100% { transform: rotate(5deg); } /* å‘å‰ç”©å‡º */
        }

        @keyframes body-shock {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(2px); }
        }

        @keyframes body-reel-back {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-15deg); } /* èº«ä½“åå€¾å¯¹æŠ—é±¼ */
        }

        /* --- å«è¡£çŒ« æ ·å¼ä¼˜åŒ– --- */
        .hoodie-main { fill: #d35400; }
        .hoodie-hem { fill: #a04000; }
        .hoodie-pocket { fill: #e67e22; }
        .hood { fill: #d35400; stroke: #a04000; stroke-width: 1px; }
        
        .cat-face { fill: #fdfdfd; }
        .ear { fill: #fdfdfd; }
        .ear-inner { fill: #ffb8b8; }
        .eye { fill: #2c3e50; }
        .eye-highlight { fill: #fff; opacity: 0.9; }
        .nose { fill: #ff7675; }
        .mouth { fill: none; stroke: #636e72; stroke-width: 1.5px; stroke-linecap: round; }
        .whiskers line { stroke: #b2bec3; stroke-width: 1px; }
        .string { fill: none; stroke: #fff; stroke-width: 1.5; opacity: 0.8; }
        
        .arm { fill: #d35400; } /* æ‰‹è‡‚é¢œè‰²å¿…é¡»å®Œå…¨ä¸€è‡´ */
        .paw { fill: #fdfdfd; }

        /* --- é±¼ç«¿æ ·å¼ --- */
        .rod-handle { fill: #2d3436; }
        .rod-main { fill: #1e272e; }
        .rod-line {
            stroke: #74b9ff;
            stroke-width: 1.5px;
            stroke-dasharray: 4 2;
            filter: drop-shadow(0 0 2px #00e6e6);
        }

        /* --- åŠ¨ç”»åŸç‚¹æ ¡å‡† --- */
        #arm-and-rod-group {
            transform-origin: 130px 105px; /* è‚©è†€å…³èŠ‚ä½ç½® */
            transition: transform 0.3s;
        }

        /* --- å•†åº—æŒ‰é’®ç‰¹æ®Šæ ·å¼ --- */
        .shop-btn {
            background: rgba(241, 196, 15, 0.1) !important;
            border: 1px solid rgba(241, 196, 15, 0.5) !important;
            transition: 0.2s;
        }
        .shop-btn:active { transform: scale(0.96); background: rgba(241, 196, 15, 0.2) !important; }

        .bobbing { animation: bob-gentle 4s ease-in-out infinite; }
        #float-wrap { position: absolute; width: 20px; height: 20px; opacity: 0; z-index: 5; font-size: 18px; pointer-events: none; }





        #float-wrap { position: absolute; width: 20px; height: 20px; opacity: 0; z-index: 5; font-size: 18px; pointer-events: none; }
        .cast-anim { animation: cast-parabola 0.8s forwards; }
        @keyframes cast-parabola {
            0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
            50% { transform: translate(70px, -180px) scale(1.2); }
            100% { transform: translate(140px, 120px) scale(1); opacity: 1; }
        }

        .bobbing { animation: bob-gentle 2s ease-in-out infinite; }
        @keyframes bob-gentle { 0%, 100% { transform: translate(140px, 120px) translateY(0); } 50% { transform: translate(140px, 120px) translateY(5px); } }
        .sinking { animation: sink-violent 0.3s infinite; }
        @keyframes sink-violent { 0% { transform: translate(140px, 130px); } 50% { transform: translate(140px, 145px); } 100% { transform: translate(140px, 130px); } }

        .splash-fx { position: absolute; left: 50%; top: 50%; width: 10px; height: 10px; border: 2px solid #fff; border-radius: 50%; pointer-events: none; opacity: 0; }
        .splash-active { animation: splash-burst 0.6s ease-out forwards; }
        @keyframes splash-burst { 0% { opacity: 1; transform: translate(145px, 130px) scale(0); } 100% { opacity: 0; transform: translate(145px, 130px) scale(6); } }

        #flying-fish { position: absolute; font-size: 40px; opacity: 0; z-index: 20; pointer-events: none; }
        .fish-fly-home { animation: fly-home 0.7s forwards; }
        @keyframes fly-home { 0% { opacity: 1; transform: translate(140px, 120px) scale(0.5); } 100% { opacity: 0; transform: translate(0, 20px) rotate(360deg); } }

        /* --- åº•éƒ¨æ§åˆ¶åŒº --- */
        .controls { position: absolute; bottom: 0; width: 100%; padding: 15px 15px 30px; background: linear-gradient(to top, #020508 60%, transparent); }
        .main-btn-group { display: flex; gap: 12px; align-items: center; margin-bottom: 15px; }
        .bait-btn { flex: 1; height: 64px; background: #161b22; border: 1px solid var(--border-color); border-radius: 16px; color: #8b949e; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .bait-btn.active { border-color: var(--accent); background: rgba(230,126,34,0.1); color: #fff; }
        
        .btn-cast { flex: 1.8; height: 72px; border-radius: 20px; border: none; font-size: 22px; font-weight: 800; color: #fff; background: linear-gradient(135deg, #e67e22, #d35400); box-shadow: 0 6px 0 #a04000; transition: 0.1s; }
        .btn-cast:active { transform: translateY(6px); box-shadow: 0 0 0 #a04000; }
        .btn-cast.biting { background: linear-gradient(135deg, #ff4757, #c0392b); box-shadow: 0 6px 0 #802020; animation: screen-shake 0.1s infinite; }

        .menu-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .btn-menu { background: rgba(22,27,34,0.8); border: 1px solid var(--border-color); color: #c9d1d9; padding: 10px 0; border-radius: 12px; font-size: 10px; display: flex; flex-direction: column; align-items: center; }

        /* --- é™æ€å›¾é‰´ UI (ç§»é™¤ 3D æ—‹è½¬) --- */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 25px; backdrop-filter: blur(10px); }
        .modal.active { display: flex; }
        .card { background: var(--card-bg); width: 100%; border-radius: 24px; padding: 25px; max-height: 80vh; overflow-y: auto; border: 1px solid var(--border-color); }

        .book-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding-bottom: 20px; }
        
        .book-item-static { 
            height: 110px; position: relative; border-radius: 16px;
            background: #0d1117; border: 1px solid #30363d;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden; transition: transform 0.2s;
        }
        .book-item-static:active { transform: scale(0.95); }
        .book-item-static.locked { opacity: 0.3; filter: grayscale(1); }

        .book-item-static span.fish-icon { 
            font-size: 36px; margin-bottom: 5px;
            animation: float-icon 3s ease-in-out infinite; 
        }
        .book-item-static .fish-name { font-size: 10px; color: #8b949e; }

        /* é™æ€ç¨€æœ‰åº¦å¢å¼º */
        .rank-A { border-color: var(--rank-A); box-shadow: inset 0 0 10px rgba(52, 152, 219, 0.2); }
        .rank-S { border-width: 2px; border-color: var(--rank-S); box-shadow: 0 0 15px rgba(46, 204, 113, 0.2); }
        
        .rank-SSR::before, .rank-GOD::before { 
            content: ''; position: absolute; inset: -50%; 
            background: conic-gradient(transparent, var(--rank-color), transparent 30%); 
            animation: rotate-border 4s linear infinite; z-index: 1; 
        }
        .rank-SSR::after, .rank-GOD::after { content: ''; position: absolute; inset: 2px; background: #0d1117; border-radius: 14px; z-index: 2; }
        /* --- æ–°å¢ï¼šSR (å²è¯—) å¡ç‰‡ç‰¹æ•ˆ --- */
        .rank-SR {
            /* ç´«è‰²å‘¼å¸è¾¹æ¡† */
            border: 1px solid #9b59b6;
            animation: sr-pulse 3s infinite alternate;
            position: relative;
            overflow: hidden;
        }
        /* SR æµå…‰æ‰«å…‰æ•ˆæœ */
        .rank-SR::after {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(155, 89, 182, 0.4), transparent);
            transform: skewX(-25deg);
            animation: sr-shine 3s infinite;
            pointer-events: none;
        }

        @keyframes sr-pulse {
            0% { box-shadow: 0 0 5px rgba(155, 89, 182, 0.2); }
            100% { box-shadow: 0 0 15px rgba(155, 89, 182, 0.6), inset 0 0 10px rgba(155, 89, 182, 0.2); }
        }
        @keyframes sr-shine {
            0% { left: -100%; }
            20% { left: 200%; } /* å¿«é€Ÿæ‰«è¿‡ */
            100% { left: 200%; } /* åœç•™ç­‰å¾… */
        }

        .rank-GOD { animation: god-distort 4s infinite; }
        .rank-GOD::after { background: #000; box-shadow: inset 0 0 20px #ff4757; }

        .book-item-static * { z-index: 5; }

        .btn-action { width: 100%; padding: 14px; border-radius: 14px; font-weight: bold; margin-top: 15px; border: none; background: #333; color: #fff; }
        /* --- æ–°å¢ï¼šå¼¹çª—å³ä¸Šè§’å…³é—­æŒ‰é’® --- */
        .card { 
            position: relative; /* å…³é”®ï¼šè®©å…³é—­æŒ‰é’®å¯ä»¥ç›¸å¯¹å®ƒå®šä½ */
        }
                .close-modal-btn {
            position: sticky; /* ã€å…³é”®ä¿®æ”¹ã€‘ä» absolute æ”¹ä¸º sticky */
            top: 15px;        /* å‘Šè¯‰å®ƒç²˜åœ¨è·ç¦»é¡¶éƒ¨15pxçš„ä½ç½® */
            right: 20px;
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            font-size: 28px;
            font-weight: 300;
            color: #666;
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
            line-height: 1;
            padding: 0;
            z-index: 10;
            /* å…³é”®ï¼šä½¿ç”¨ float æŠŠå®ƒæ¨åˆ°å³è¾¹ï¼Œå› ä¸º sticky å®šä½ä¼šå½±å“å·¦å³å®šä½ */
            float: right; 
            margin-bottom: -32px; /* è¡¥å¿å®ƒå ç”¨çš„ç©ºé—´ï¼Œé˜²æ­¢æ ‡é¢˜ä¸‹ç§» */
        }
        .close-modal-btn:hover {
            color: #fff;
            transform: scale(1.2) rotate(90deg);
        }

        
        #toast-notification {
            position: fixed;
            top: 80px; /* åœ¨HUDä¸‹æ–¹æ˜¾ç¤º */
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(45, 52, 54, 0.9);
            color: #fff;
            border-radius: 20px;
            border: 1px solid #636e72;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s, top 0.3s;
            pointer-events: none; /* è®©å®ƒä¸å¯ç‚¹å‡» */
            display: none; /* åˆå§‹éšè— */
        }
        /* æˆåŠŸæç¤ºçš„é¢œè‰² */
        #toast-notification.success {
            background: rgba(46, 204, 113, 0.9);
            border-color: #27ae60;
        }
        /* å¤±è´¥/é”™è¯¯æç¤ºçš„é¢œè‰² */
        #toast-notification.error {
            background: rgba(231, 76, 60, 0.9);
            border-color: #c0392b;
        }

        #toast-notification.show {
            display: block;
            top: 100px; /* æ»‘å‡ºåçš„ä½ç½® */
            opacity: 1;
        }

        /* --- æ–°å¢ï¼šè®©HUDåœ¨å¼¹çª—ä¹‹ä¸Š --- */
        .header-group.hud-on-top {
            z-index: 2100; /* é«˜äºå¼¹çª—çš„z-index: 2000 */
        }


    </style>
</head>
<body>

<div id="god-fx"></div>

 <div id="toast-notification"></div>

<div id="settings-drawer" class="settings-drawer" onclick="app.toggleSettings(false)">
    <div class="settings-content" onclick="event.stopPropagation()">
        <h3 style="margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">âš™ï¸ èˆªæµ·æ—¥å¿—</h3>
        <div class="setting-row">
            <span>éŸ³æ•ˆåé¦ˆ</span>
            <input type="range" min="0" max="100" value="50" oninput="app.setVolume(this.value)" style="width:100px;">
        </div>
        <div style="margin-top:auto; padding-top:20px;">
            <button onclick="app.resetData()" style="width:100%; padding:12px; background:rgba(255,71,87,0.1); border:1px solid #ff4757; color:#ff4757; border-radius:8px;">âš ï¸ é‡æ–°å¼€å§‹å†’é™©</button>
        </div>
    </div>
</div>

<div class="stage" id="stage-main">
    <div class="header-group">
        <div class="hud">
            <div class="hud-item" style="color:#ffc107">ğŸ’° <span id="ui-coin">0</span></div>
            <div class="hud-item" style="color:#2ecc71">ğŸ§ª <span id="ui-oil">0</span></div>
        </div>
        <div id="buff-ui" class="buff-tag">å¹¸è¿åŠ æŒä¸­ âœ¨</div>
    </div>

    <div class="game-view">
                <!-- ç»™å®¹å™¨åŠ ä¸ªIDï¼Œæ–¹ä¾¿JSæ§åˆ¶å…¨èº« -->
    <div id="cat-container" class="cat-box">
        <svg id="hoodie-cat-svg" viewBox="0 0 200 180">
            <defs>
                <!-- ä¼˜åŒ–åçš„é˜´å½±ï¼šæ›´ç´§å®ï¼Œå‡å°‘åˆ†ç¦»æ„Ÿ -->
                <filter id="solid-shadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="1" />
                    <feOffset dx="0" dy="1" result="offsetblur" />
                    <feComponentTransfer>
                        <feFuncA type="linear" slope="0.4" />
                    </feComponentTransfer>
                    <feMerge>
                        <feMergeNode />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
            </defs>

            <!-- 1. åå±‚ï¼šå·¦è‡‚ (ä½œä¸ºèƒŒæ™¯) -->
            <g transform="translate(0, 5)">
                 <path class="arm" d="M 85,105 C 65,100 55,120 75,130" filter="url(#solid-shadow)" />
                 <circle class="paw" cx="75" cy="130" r="8" />
            </g>

            <!-- 2. æ ¸å¿ƒå±‚ï¼šèº«ä½“å’Œå¤´éƒ¨ (ä¸€ä½“åŒ–è®¾è®¡) -->
            <g id="cat-torso-group" filter="url(#solid-shadow)">
                <!-- èº«ä½“ï¼šå‘ä¸Šå»¶ä¼¸ï¼Œè¿æ¥å¤´éƒ¨ -->
                <path class="hoodie-main" d="M 60,160 C 40,150 40,100 65,85 C 80,75 120,75 135,85 C 160,100 160,150 140,160 L 60,160 Z" />
                <path class="hoodie-hem" d="M 60,160 Q 100,165 140,160 L 140,152 Q 100,157 60,152 Z" />
                <path class="hoodie-pocket" d="M 75,135 Q 100,150 125,135 L 120,125 L 80,125 Z" />
                
                <!-- å¤´éƒ¨ï¼šç›´æ¥å åœ¨èº«ä½“ä¸Šæ–¹ï¼Œè¦†ç›–è¿æ¥å¤„ -->
                <g transform="translate(0, 2)">
                    <path class="hood" d="M 55,85 C 40,40 70,5 100,5 C 130,5 160,40 145,85 C 140,95 130,100 100,100 C 70,100 60,95 55,85" />
                    <ellipse class="cat-face" cx="100" cy="75" rx="38" ry="34" />
                    
                    <path class="ear" d="M 62,50 C 55,25 75,25 75,40" />
                    <path class="ear-inner" d="M 64,48 C 60,35 68,35 68,41" />
                    
                    <path class="ear" d="M 138,50 C 145,25 125,25 125,40" />
                    <path class="ear-inner" d="M 136,48 C 140,35 132,35 132,41" />

                    <!-- äº”å®˜ -->
                    <g id="face-features">
                        <circle class="eye" cx="86" cy="74" r="5" />
                        <circle class="eye-highlight" cx="88" cy="72" r="2" />
                        <circle class="eye" cx="114" cy="74" r="5" />
                        <circle class="eye-highlight" cx="116" cy="72" r="2" />
                        <path class="nose" d="M 97,84 L 103,84 L 100,88 Z" />
                        <path class="mouth" d="M 94,91 Q 100,95 106,91" />
                        <g class="whiskers">
                            <line x1="68" y1="78" x2="48" y2="74" />
                            <line x1="68" y1="84" x2="48" y2="86" />
                            <line x1="132" y1="78" x2="152" y2="74" />
                            <line x1="132" y1="84" x2="152" y2="86" />
                        </g>
                    </g>
                </g>
                
                <!-- å«è¡£ç»³ç»†èŠ‚ -->
                <path class="string" d="M 92,100 L 92,115" />
                <circle cx="92" cy="117" r="2" fill="#fff" />
                <path class="string" d="M 108,100 L 108,115" />
                <circle cx="108" cy="117" r="2" fill="#fff" />
            </g>

            <!-- 3. å‰å±‚ï¼šå³è‡‚å’Œé±¼ç«¿ (åŠ¨ç”»ç»„) -->
            <g id="arm-and-rod-group">
                <!-- è¢–å­ï¼šæ ¹éƒ¨åŠ ç²—ï¼Œæ·±å…¥èº«ä½“å†…éƒ¨ -->
                <path class="arm" d="M 125,95 C 125,95 145,90 155,110 C 160,120 150,130 140,125" filter="url(#solid-shadow)" />
                <circle class="paw" cx="140" cy="125" r="8" />
                
                <!-- é±¼ç«¿ -->
                <g class="rod-svg">
                    <rect class="rod-handle" x="134" y="112" width="10" height="22" rx="2" transform="rotate(-15, 139, 123)" />
                    <rect class="rod-main" x="140" y="98" width="85" height="4" rx="2" transform="rotate(-25, 140, 100)" />
                    <line class="rod-line" x1="215" y1="63" x2="215" y2="120" stroke-opacity="0.8" />
                </g>
            </g>
        </svg>
    </div>





        <div id="flying-fish">ğŸŸ</div>
        <div id="float-wrap">ğŸ”´</div>
        <div id="splash" class="splash-fx"></div>
    </div>

    <div class="controls">
        <div class="main-btn-group">
            <button id="b-1" onclick="app.switchBait(1)" class="bait-btn active">
                <span>ğŸª±</span><small>æ™®é€š x<span id="c-1">0</span></small>
            </button>
            <button id="main-btn" onclick="app.action()" class="btn-cast">æŠ› ç«¿</button>
            <button id="b-2" onclick="app.switchBait(2)" class="bait-btn">
                <span>ğŸ›</span><small>é«˜çº§ x<span id="c-2">0</span></small>
            </button>
        </div>
        
        <div class="menu-grid">
            <button onclick="app.toggleSettings(true)" class="btn-menu"><span>âš™ï¸</span>è®¾ç½®</button>
            <button onclick="app.openModal('achModal'); app.renderAch();" class="btn-menu"><span>ğŸ†</span>æˆå°±</button>
            <button onclick="app.openModal('invModal'); app.renderInv();" class="btn-menu"><span>ğŸ’</span>èƒŒåŒ…</button>
            <button onclick="app.openModal('bookModal'); app.renderBook();" class="btn-menu"><span>ğŸ“–</span>å›¾é‰´</button>
            <button onclick="app.openModal('upgradeModal'); app.renderUpgrade();" class="btn-menu" style="color:#2ecc71"><span>ğŸ”¨</span>å¼ºåŒ–</button>
        </div>
                        <button onclick="app.openModal('shopModal')" class="btn-menu" style="width:100%; margin-top:8px; flex-direction:row; gap:10px; color:#f1c40f; border: 1px solid rgba(241, 196, 15, 0.3); font-weight:bold;">
            <span style="font-size:22px;">ğŸª</span> æ¸”å¤«ç™¾å®ç®±
        </button>


    </div>
</div>

<div id="shopModal" class="modal"><div class="card">
    <h3 style="text-align:center; margin-bottom:20px;">ğŸ›’ æ¸”å¤«ç™¾å®ç®±</h3>
<button class="close-modal-btn" onclick="app.closeModal('shopModal')">Ã—</button>

    <div style="display:grid; gap:12px;">
        <div onclick="app.buy('bait',10,50)" style="background:#1c2128; padding:15px; border-radius:15px; display:flex; justify-content:space-between; align-items:center;"><span>ğŸª± æ™®é€šé±¼é¥µ x10</span><b style="color:var(--accent)">ğŸ’°50</b></div>
        <div onclick="app.buy('pbait',5,200)" style="background:#1c2128; padding:15px; border-radius:15px; display:flex; justify-content:space-between; align-items:center;"><span>ğŸ› é«˜çº§é±¼é¥µ x5</span><b style="color:var(--accent)">ğŸ’°200</b></div>
        <div onclick="app.buy('oil',1,1000)" style="background:#1c2128; padding:15px; border-radius:15px; display:flex; justify-content:space-between; align-items:center;"><span>ğŸ§ª å¹¸è¿é±¼æ²¹ x1</span><b style="color:var(--accent)">ğŸ’°1000</b></div>
    </div>
    
</div></div>

<div id="upgradeModal" class="modal"><div class="card">
    <h3>ğŸ”¨ é±¼ç«¿å¼ºåŒ– (Lv.1 - 50)</h3>
<button class="close-modal-btn" onclick="app.closeModal('upgradeModal')">Ã—</button>
    <div id="upgrade-content" style="text-align:center;">
        <div style="font-size:50px; margin:10px 0;">ğŸ£</div>
        <p>ç­‰çº§: <span id="rod-lv">1</span> / 50</p>
        <p style="font-size:12px; color:#8b949e;">å…¸è—åŠ æˆ: <span id="rod-bonus">0.0%</span></p>
        <div id="upgrade-btn-box" style="margin-top:20px;"></div>
    </div>
    
</div></div>

<div id="bookModal" class="modal"><div class="card">
    <h3>ğŸ“– 108å…¨å›¾é‰´ç‰¹åˆŠ</h3>
<button class="close-modal-btn" onclick="app.closeModal('bookModal')">Ã—</button>
    <div id="book-content" style="margin-top:15px;"></div>
    </div></div>

<div id="invModal" class="modal"><div class="card"><h3>ğŸ’ ä¸ªäººèƒŒç¯“</h3>
<button class="close-modal-btn" onclick="app.closeModal('invModal')">Ã—</button>


<div id="inv-list"></div><button onclick="app.sellAll()" class="btn-action" style="background:var(--accent); color:#fff;">å…¨éƒ¨å”®å‡º</button>
</div></div>
<div id="achModal" class="modal"><div class="card"><h3>ğŸ† ç”Ÿæ¶¯æˆå°±</h3>
<button class="close-modal-btn" onclick="app.closeModal('achModal')">Ã—</button>
<div id="ach-list"></div></div></div>

<div id="catchPop" class="modal" style="z-index:3000;"><div class="card" style="text-align:center; border:2px solid #fff;">
    <p id="p-rank" style="font-weight:900; font-size:20px;">RANK</p>
    <div id="p-emoji" style="font-size:100px; margin:20px 0;">ğŸ </div>
    <h2 id="p-name">åç§°</h2>
    <button onclick="app.closeModal('catchPop')" class="btn-action" style="background:#238636; color:#fff;">æ”¶å…¥èƒŒç¯“</button>
</div></div>

<script>
// --- éŸ³æ•ˆä¸é€»è¾‘æ ¸å¿ƒ (å…¨é‡ä¿ç•™) ---
class AudioSys {
    constructor() { this.ctx = null; this.masterGain = null; this.volume = 0.5; }
    init() {
        if (this.ctx) return;
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        this.ctx = new AudioContext();
        this.masterGain = this.ctx.createGain();
        this.masterGain.gain.value = this.volume;
        this.masterGain.connect(this.ctx.destination);
    }
    setVolume(val) { this.volume = val/100; if(this.masterGain) this.masterGain.gain.value = this.volume; }
    playSfx(type) {
        if(!this.ctx) this.init(); if(this.ctx.state==='suspended') this.ctx.resume();
        const t = this.ctx.currentTime;
        const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
        o.connect(g); g.connect(this.masterGain);
        if(type==='cast'){ o.type='triangle'; o.frequency.setValueAtTime(600,t); o.frequency.exponentialRampToValueAtTime(100,t+0.3); g.gain.setValueAtTime(0.3,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.3); o.start(t); o.stop(t+0.3); }
        else if(type==='splash'){ o.type='square'; o.frequency.setValueAtTime(100,t); o.frequency.exponentialRampToValueAtTime(30,t+0.4); g.gain.setValueAtTime(0.4,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.4); o.start(t); o.stop(t+0.4); }
        else if(type==='catch'){ [523, 659, 784].forEach((f,i)=>{ const oo=this.ctx.createOscillator(); const gg=this.ctx.createGain(); oo.frequency.value=f; gg.gain.setValueAtTime(0.2,t+i*0.1); gg.gain.exponentialRampToValueAtTime(0.01,t+i*0.1+0.3); oo.connect(gg); gg.connect(this.masterGain); oo.start(t+i*0.1); oo.stop(t+i*0.1+0.3); }); }
    }
}
const audio = new AudioSys();

const RANKS = {
    // Bçº§ (å…±50ç§ - å¸¸è§æ°´äº§å’Œäººé—´ç™¾æ€)
    B: { color: '#95a5a6', price: 20, count: 50,
        emoji: ['ğŸŸ','ğŸ ','ğŸ¡','ğŸ¦€','ğŸ¦','ğŸš','ğŸ™','ğŸ¦‘','ğŸ¦','ğŸŒ','ğŸ¸','ğŸŒ¿','ğŸªµ','ğŸª¨','ğŸƒ','ğŸ‚','ğŸ„','ğŸº','ğŸ”‘','ğŸª™','ğŸ§­','ğŸ¥«','ğŸ¾','ğŸ—ï¸','ğŸ§»','ğŸ“¦','ğŸ“','ğŸ£','ğŸª','âš“','ğŸ¥','ğŸ€','ğŸˆ','âš¾','ğŸ¾','ğŸ','ğŸ‰','ğŸ±','ğŸ¸','ğŸ¥','ğŸ','ğŸ‘','ğŸ¥','ğŸª','ğŸ›·','ğŸªƒ','ğŸª€','ğŸ§©','ğŸ§±','âš™ï¸'],
        names: ['å°æ‚é±¼','æ¡çº¹é±¼','é¼“é¼“æ²³é²€','çº¢èƒèŸ¹','é²œç¾å°è™¾','ä¸ƒå½©è´å£³','å°ç« é±¼','å¢¨æ–—é±¼','æ·¡æ°´é¾™è™¾','æµ·èœ—ç‰›','ç»¿é’è›™','éŸ§æ€§æ°´è‰','æ¼‚æµæœ¨','å…‰æ»‘çš„çŸ³å¤´','ç»¿å¶','æ¯å¶','æ¯’è˜‘è‡','å¤ä»£é™¶ç½','ç”Ÿé”ˆçš„é’¥åŒ™','ä¸çŸ¥åç¡¬å¸','å¤±çµçš„ç½—ç›˜','ç¥ç§˜ç½å¤´','ç©ºé…’ç“¶','æ—§æŠ¥çº¸','ä¸€å·çº¸','æ¹¿çº¸ç®±','å›å½¢é’ˆ','æ–­æ‰çš„é±¼ç«¿','æ—§é±¼é’©','èˆ¹é”š','å’çƒ','ç¯®çƒ','æ©„æ¦„çƒ','æ£’çƒ','ç½‘çƒ','æ’çƒ','è‹±å¼æ©„æ¦„çƒ','é»‘8','ç¾½æ¯›çƒ','é•¿æ›²æ£çƒ','æ¿çƒ','æ›²æ£çƒ','é£ç›˜','é£ç­','é›ªæ©‡','å›æ—‹é•–','æ‚ æ‚ çƒ','æ‹¼å›¾ç¢ç‰‡','ä¸€å—æ¿ç –','é½¿è½®']
    },
    // Açº§ (å…±25ç§ - è¾ƒå¤§å‹æˆ–æœ‰ç‰¹è‰²çš„åŠ¨ç‰©)
    A: { color: '#3498db', price: 80, count: 25,
        emoji: ['ğŸ¬','ğŸ³','ğŸ‹','ğŸ¢','ğŸŠ','ğŸ§','ğŸ¦ˆ','ğŸ¦­','ğŸ¦¦','ğŸ´','ğŸ˜','ğŸ…','ğŸƒ','ğŸ','ğŸ–','ğŸ¦Œ','ğŸ¦˜','ğŸ¦','ğŸ¦›','ğŸ¦’','ğŸ¦“','ğŸ¦','ğŸ','ğŸ¦¢','ğŸ»'],
        names: ['æµ·è±š','è™é²¸','åº§å¤´é²¸','å¤§æµ·é¾Ÿ','å’¸æ°´é³„','å¸ä¼é¹…','å¤§ç™½é²¨','æ–‘ç‚¹æµ·è±¹','æ°´ç­','é¾™é©¬','è±¡æµ·è±¹','è™çº¹é±¼','æµ·ç‰›','ç›˜ç¾Šèº','æ±Ÿè±š','æµ·é¹¿','è·³è·³é±¼','çŠ€è§’é±¼','æ²³é©¬','é•¿é¢ˆé³—','æ–‘é©¬é±¼','é‡‘åˆšèŸ¹','æµ·è›‡','é»‘å¤©é¹…','åŒ—æç†Š']
    },
    // Sçº§ (å…±15ç§ - ç¨€æœ‰çš„é£è¡Œç”Ÿç‰©æˆ–å¼‚å…½)
    S: { color: '#2ecc71', price: 300, count: 15,
        emoji: ['ğŸ¦…','ğŸ¦‰','ğŸ¦œ','ğŸ¦‹','ğŸ¦š','ğŸ¦©','ğŸ•Šï¸','ğŸ¦‡','ğŸ¦‚','ğŸ•·ï¸','ğŸ¦—','ğŸª²','ğŸ¦','ğŸŒ','ğŸ²'],
        names: ['å·¨é¹°','é›ªç™½çŒ«å¤´é¹°','å¤šå½©é¹¦é¹‰','å¹»å½©è¶','å¼€å±å­”é›€','ç«çƒˆé¸Ÿ','å’Œå¹³é¸½','å·¨ç¿¼è ','å‰§æ¯’è','ç‹¼è››','é‡‘è‰²é¸£è™«','åœ£ç”²è™«','å˜è‰²é¾™','å½©è™¹èœ—ç‰›','å°å‹é£é¾™']
    },
    // SRçº§ (å…±10ç§ - é™†åœ°ä¸Šçš„å¼ºå¤§æˆ–å¹»æƒ³ç”Ÿç‰©)
    SR: { color: '#9b59b6', price: 1000, count: 10,
        emoji: ['ğŸº','ğŸ¦Š','ğŸ¦','ğŸ¯','ğŸ¼','ğŸ¦','ğŸ†','ğŸ—','ğŸ¦–','ğŸ¦•'],
        names: ['éœœåŸç‹¼','ä¹å°¾ç‹','é»„é‡‘é›„ç‹®','ç™½è™','å¤ªæç†ŠçŒ«','å·¨çµé‡‘åˆš','æš—å½±çŒè±¹','å±±æ—é‡çŒª','éœ¸ç‹é¾™éª¸éª¨','é•¿é¢ˆé¾™åŒ–çŸ³']
    },
    // SSRçº§ (å…±7ç§ - ä¼ è¯´ä¸­çš„åœ£ç‰©æˆ–ç¥å…½)
    SSR: { color: '#f1c40f', price: 5000, count: 7,
        emoji: ['ğŸ¦„','ğŸ‰','ğŸ”¥','ğŸ’','ğŸ‘‘','ğŸ”±','ğŸ§¿'],
        names: ['åœ£æ´ç‹¬è§’å…½','ä¸œæ–¹åº”é¾™','ä¸ç­ä¹‹ç«','ä»¥å¤ªæ°´æ™¶','å¤±è½ç‹å† ','æ³¢å¡å†¬ä¸‰å‰æˆŸ','å®ˆæŠ¤è€…ä¹‹çœ¼']
    },
    // GODçº§ (å…±3ç§ - å®‡å®™çº§çš„å­˜åœ¨)
    GOD: { color: '#ff4757', price: 25000, count: 3,
        emoji: ['â˜€ï¸','ğŸŒŒ','â˜„ï¸'],
        names: ['æ’æ˜Ÿç¢ç‰‡','æ—‹æ¶¡æ˜Ÿç³»','åˆ›ä¸–ä¹‹é™¨']
    }
};


class FishingGame {
    constructor() { this.load(); this.status='idle'; this.updateUI(); }
    load() {
        this.coin = parseInt(localStorage.getItem('f_coin')) || 1000;
        this.bait = parseInt(localStorage.getItem('f_bait')) || 20;
        this.pbait = parseInt(localStorage.getItem('f_pbait')) || 5;
        this.oil = parseInt(localStorage.getItem('f_oil')) || 0;
        this.rodLv = parseInt(localStorage.getItem('f_rodlv')) || 1;
        this.inv = JSON.parse(localStorage.getItem('f_inv')) || [];
        this.coll = new Set(JSON.parse(localStorage.getItem('f_coll')) || []);
        this.achieved = new Set(JSON.parse(localStorage.getItem('f_achieved')) || []);
        this.totalC = parseInt(localStorage.getItem('f_totalC')) || 0;
        this.activeBait = 1; this.hasBuff = false;
    }
    save() {
        localStorage.setItem('f_coin', this.coin); localStorage.setItem('f_bait', this.bait);
        localStorage.setItem('f_pbait', this.pbait); localStorage.setItem('f_oil', this.oil);
        localStorage.setItem('f_rodlv', this.rodLv); localStorage.setItem('f_inv', JSON.stringify(this.inv));
        localStorage.setItem('f_coll', JSON.stringify([...this.coll])); localStorage.setItem('f_achieved', JSON.stringify([...this.achieved]));
        localStorage.setItem('f_totalC', this.totalC);
    }
    showToast(message, type = '') {
        const toast = document.getElementById('toast-notification');
        if (!toast) return;

        toast.textContent = message;
        toast.className = ''; // æ¸…é™¤æ—§çš„ç±»å‹
        if (type) {
            toast.classList.add(type);
        }

        toast.classList.add('show');

        // æ¸…é™¤ä¸Šä¸€ä¸ªè®¡æ—¶å™¨ï¼Œé˜²æ­¢å¿«é€Ÿç‚¹å‡»æ—¶æç¤ºæå‰æ¶ˆå¤±
        if (this.toastTimer) clearTimeout(this.toastTimer);

        this.toastTimer = setTimeout(() => {
            toast.classList.remove('show');
        }, 2500); // 2.5ç§’åè‡ªåŠ¨æ¶ˆå¤±
    }


    updateUI() {
        document.getElementById('ui-coin').innerText = this.coin.toLocaleString();
        document.getElementById('ui-oil').innerText = this.oil;
        document.getElementById('c-1').innerText = this.bait;
        document.getElementById('c-2').innerText = this.pbait;
        document.getElementById('buff-ui').style.display = this.hasBuff ? 'block' : 'none';
        const btn = document.getElementById('main-btn');
        if(this.status==='idle') { btn.innerText='æŠ› ç«¿'; btn.className='btn-cast'; }
        else if(this.status==='biting') { btn.innerText='æ ç«¿ !'; btn.className='btn-cast biting'; }
        else { btn.innerText='ç­‰å¾…ä¸­...'; btn.className='btn-cast waiting'; }
        this.save();
    }
    getRodBonus() { return ((this.rodLv-1)/49)*0.06; }
    renderUpgrade() {
        document.getElementById('rod-lv').innerText = this.rodLv;
        document.getElementById('rod-bonus').innerText = (this.getRodBonus()*100).toFixed(1) + "%";
        const cost = this.rodLv < 50 ? Math.floor(this.rodLv * 800 * Math.pow(1.12, this.rodLv)) : null;
        document.getElementById('upgrade-btn-box').innerHTML = cost ? `<button class="btn-action" style="background:var(--rank-S); color:#fff;" onclick="app.upgradeRod(${cost})">æ¶ˆè€— ğŸ’°${cost.toLocaleString()} å¼ºåŒ–</button>` : `<button class="btn-action" disabled>å·²è¾¾æœ€é«˜çº§</button>`;
    }
    upgradeRod(c) { if(this.coin >= c){ this.coin-=c; this.rodLv++; this.renderUpgrade(); this.updateUI(); audio.playSfx('catch'); } else alert('é‡‘å¸ä¸è¶³'); }
      
            async action() {
        audio.init();
        if (this.status === 'casting' || this.status === 'catching') return;

        if (this.status === 'biting') {
            this.catchFish();
            return;
        }

        if ((this.activeBait === 1 ? this.bait : this.pbait) <= 0) { alert('æ²¡æœ‰é±¼é¥µäº†'); return; }
        if (this.activeBait === 1) this.bait--; else this.pbait--;
        if (this.oil > 0 && !this.hasBuff) { this.oil--; this.hasBuff = true; }

        this.status = 'casting';
        this.updateUI();
        audio.playSfx('cast');

        document.getElementById('cat-container').classList.add('casting');

        const fw = document.getElementById('float-wrap');
        fw.className = 'cast-anim';
        fw.style.opacity = '1';

        setTimeout(() => {
           document.getElementById('cat-container').classList.remove('casting');


            audio.playSfx('splash');
            document.getElementById('splash').classList.add('splash-active');
            setTimeout(() => document.getElementById('splash').classList.remove('splash-active'), 600);

            fw.className = '';
            void fw.offsetWidth;
            fw.style.animation = 'float-land-wobble 0.3s, bob-gentle 2.5s 0.3s ease-in-out infinite';
        }, 500);

        setTimeout(() => {
            this.status = 'biting';
            this.updateUI();

            fw.style.animation = 'sink-violent 0.4s ease-in-out infinite alternate';
            document.getElementById('cat-container').classList.add('biting');
            document.getElementById('stage-main').classList.add('bite-shake');

            this.timer = setTimeout(() => {
                if (this.status === 'biting') this.reset();
            }, 1800);
        }, 2000 + Math.random() * 3000);
    }


           async catchFish() {
        if (this.status !== 'biting') return;
        this.status = 'catching';

        clearTimeout(this.timer);
        audio.playSfx('catch');

        document.getElementById('stage-main').classList.remove('bite-shake');
        document.getElementById('stage-main').classList.add('impact-shake');
        setTimeout(() => document.getElementById('stage-main').classList.remove('impact-shake'), 200);

       document.getElementById('cat-container').classList.add('reeling');



        // ã€å…³é”®ä¿®å¤ã€‘ä½¿ç”¨ä¸€ä¸ªæ–°çš„ã€ç‹¬ç«‹çš„setTimeoutæ¥å¤„ç†åŠ¨ç”»ç»“æŸåçš„é€»è¾‘
        // è¿™ä¸ªæ—¶é—´ï¼ˆ700msï¼‰å¿…é¡»ä¸CSSä¸­ 'rod-reel-in-fight' åŠ¨ç”»çš„æŒç»­æ—¶é—´ä¸€è‡´
        setTimeout(() => {
            const fly = document.getElementById('flying-fish');
            const pool = RANKS[r]; // æ³¨æ„ï¼šrå˜é‡éœ€è¦åœ¨ä¸‹é¢å®šä¹‰
            
            fly.innerText = fish.emoji;
            fly.className = 'fish-fly-home';
            fly.style.opacity = '1';
            
            setTimeout(() => {
                document.getElementById('p-rank').innerText = r + " RANK";
                document.getElementById('p-rank').style.color = pool.color;
                document.getElementById('p-emoji').innerText = fish.emoji;
                document.getElementById('p-name').innerText = fish.name;
                this.openModal('catchPop');
                fly.style.opacity = '0';
                this.hasBuff = false;
                this.reset();
            }, 700); // é£è¡Œæ—¶é—´

        }, 700); // æ”¶ç«¿åŠ¨ç”»æ—¶é—´

        // [è®¡ç®—é±¼çš„ç¨€æœ‰åº¦ã€å¼¹å‡ºçª—å£çš„é€»è¾‘ä¿æŒä¸å˜ï¼Œä½†è¦ç¡®ä¿å˜é‡åœ¨ä½œç”¨åŸŸå†…]
        const luck = Math.random(); const bonus = this.getRodBonus(); const mult = this.hasBuff ? 2.5 : 1;
        let r = 'B';
        const p = this.activeBait === 2 ? [0.005 * mult + bonus, 0.1 * mult + bonus, 0.25 * mult, 0.5 * mult, 0.75] : [0.005 * mult + bonus, 0.02 * mult + bonus, 0.08 * mult, 0.2 * mult, 0.45];
        if (luck < p[0]) r = 'GOD'; else if (luck < p[1]) r = 'SSR'; else if (luck < p[2]) r = 'SR'; else if (luck < p[3]) r = 'S'; else if (luck < p[4]) r = 'A';

        if (r === 'GOD' || r === 'SSR') { document.getElementById('god-fx').className = 'god-flash-anim'; setTimeout(() => document.getElementById('god-fx').className = '', 1200); }

        const pool = RANKS[r];
        const idx = Math.floor(Math.random() * pool.names.length);
        const fish = { name: pool.names[idx], emoji: pool.emoji[idx], rank: r, price: pool.price };

        this.inv.push(fish);
        this.coll.add(fish.name);
        this.totalC++;
    }


        reset() {
        this.status = 'idle';
        const fw = document.getElementById('float-wrap');
        fw.className = '';
        fw.style.animation = ''; // å½»åº•æ¸…é™¤å†…è”åŠ¨ç”»ï¼Œé˜²æ­¢åŠ¨ç”»æ®‹ç•™
        fw.style.opacity = '0';
       const cat = document.getElementById('cat-container');


cat.classList.remove('casting', 'biting', 'reeling');

        document.getElementById('stage-main').classList.remove('bite-shake'); // ç¡®ä¿æ¸…é™¤æ‰€æœ‰éœ‡åŠ¨
        this.updateUI();
    }

    
    renderBook() {
    const cont = document.getElementById('book-content');
    cont.innerHTML = '';
    ['GOD','SSR','SR','S','A','B'].forEach(rk => {
        const d = RANKS[rk];
        const collectedCount = d.names.filter(n => this.coll.has(n)).length;
        
        let html = `<div style="color:${d.color}; font-weight:bold; margin:20px 0 10px; font-size:12px; border-left:3px solid ${d.color}; padding-left:8px;">${rk}çº§ (${collectedCount}/${d.names.length})</div><div class="book-grid">`;

        for (let i = 0; i < d.names.length; i++) {
            const isUnlocked = this.coll.has(d.names[i]);
            const emoji = d.emoji[i % d.emoji.length] || 'ï¼Ÿ';

            html += `<div class="book-item-static ${isUnlocked ? '' : 'locked'} rank-${rk}" style="--rank-color:${d.color}">
                <span class="fish-icon">${isUnlocked ? emoji : 'ï¼Ÿ'}</span>
                <span class="fish-name">${isUnlocked ? d.names[i] : 'æœªçŸ¥'}</span>
            </div>`;
        }
        cont.innerHTML += html + '</div>';
    });
}


        renderAch() {
        const list = document.getElementById('ach-list');
        list.innerHTML = '';

        // è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦è§£é”äº†æŸä¸ªç­‰çº§çš„ä»»æ„ä¸€æ¡é±¼
        const hasRank = (rankKey) => {
            return RANKS[rankKey].names.some(name => this.coll.has(name));
        };

        const achs = [
            // 1. æ•°é‡ç±»
            {id:'cnt10', t:'æ–°æ™‹æ¸”å¤«', d:'ç´¯è®¡æ•è· 10 æ¡é±¼', v:this.totalC>=10, r:200},
            {id:'cnt100', t:'æµ·æ´‹å¾æœè€…', d:'ç´¯è®¡æ•è· 100 æ¡é±¼', v:this.totalC>=100, r:2000},
            
            // 2. è´¢å¯Œç±»
            {id:'rich1', t:'ç¬¬ä¸€æ¡¶é‡‘', d:'æŒæœ‰é‡‘å¸è¾¾åˆ° 5,000', v:this.coin>=5000, r:1000},
            {id:'rich2', t:'å¤§å¯Œè±ª', d:'æŒæœ‰é‡‘å¸è¾¾åˆ° 50,000', v:this.coin>=50000, r:10000},

            // 3. æ”¶é›†ç±»
            {id:'col10', t:'ç”Ÿç‰©å­¦å®¶', d:'è§£é” 10 ç§ä¸åŒçš„å›¾é‰´', v:this.coll.size>=10, r:1500},
            {id:'col50', t:'å…¨çŸ¥å…¨èƒ½', d:'è§£é” 50 ç§ä¸åŒçš„å›¾é‰´', v:this.coll.size>=50, r:8000},

            // 4. ç¨€æœ‰åº¦ç±»
            {id:'getSR', t:'ç´«æ°”ä¸œæ¥', d:'è§£é”ä»»æ„ä¸€åª SR çº§ç”Ÿç‰©', v:hasRank('SR'), r:3000},
            {id:'getSSR', t:'æ¬§çš‡æ—¶åˆ»', d:'è§£é”ä»»æ„ä¸€åª SSR çº§ç”Ÿç‰©', v:hasRank('SSR'), r:10000}
        ];

        achs.forEach(a => {
            const isClaimed = this.achieved.has(a.id);
            const canClaim = a.v && !isClaimed;
            
            let btnHtml = '';
            if (isClaimed) btnHtml = `<button class="btn-action" style="width:70px; margin:0; padding:6px; font-size:12px; background:#222; color:#555;" disabled>å·²é¢†</button>`;
            else if (canClaim) btnHtml = `<button class="btn-action" style="width:70px; margin:0; padding:6px; font-size:12px; background:var(--rank-S); color:#fff; animation: pulse 1s infinite;" onclick="app.claimAch('${a.id}',${a.r})">é¢† ğŸ’°${a.r}</button>`;
            else btnHtml = `<button class="btn-action" style="width:70px; margin:0; padding:6px; font-size:12px; background:#333; color:#888;" disabled>ğŸ”’</button>`;

            list.innerHTML += `
            <div style="padding:12px; border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:bold; color:${a.v ? '#fff' : '#888'}">${a.t}</div>
                    <div style="font-size:11px; color:#666;">${a.d}</div>
                </div>
                ${btnHtml}
            </div>`;
        });
    }

        
    claimAch(id,r){ if(!this.achieved.has(id)){this.achieved.add(id); this.coin+=r; this.updateUI(); this.renderAch(); audio.playSfx('catch');} }
    renderInv() {
        const list = document.getElementById('inv-list'); list.innerHTML = this.inv.length ? '' : '<p style="text-align:center; padding:20px; color:#555;">èƒŒç¯“æ˜¯ç©ºçš„</p>';
        [...this.inv].reverse().forEach(f => { list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222; display:flex; justify-content:space-between;"><span>${f.emoji} ${f.name} <small style="color:${RANKS[f.rank].color}">${f.rank}</small></span><span style="color:#f1c40f">ğŸ’°${f.price}</span></div>`; });
    }
       sellAll() {
        if (!this.inv.length) {
            this.showToast("èƒŒåŒ…æ˜¯ç©ºçš„ï¼");
            return;
        }
        let t = 0;
        this.inv.forEach(f => t += f.price);
        this.coin += t;
        this.inv = [];
        this.updateUI();
        this.renderInv();
        audio.playSfx('catch');
        // ä½¿ç”¨æˆåŠŸæç¤º
        this.showToast(`å…¨éƒ¨å”®å‡ºï¼Œè·å¾— ğŸ’°${t}`, 'success');
    }
 
       buy(t, a, p) {
        if (this.coin >= p) {
            this.coin -= p;
            this[t] += a;
            this.updateUI();
            audio.playSfx('catch');
            // ä½¿ç”¨æˆåŠŸæç¤º
            this.showToast(`è´­ä¹°æˆåŠŸï¼`, 'success');
        } else {
            // ä½¿ç”¨é”™è¯¯æç¤º
            this.showToast('é‡‘å¸ä¸è¶³ï¼', 'error');
        }
    }

    switchBait(t) { this.activeBait=t; document.getElementById('b-1').className=t===1?'bait-btn active':'bait-btn'; document.getElementById('b-2').className=t===2?'bait-btn active':'bait-btn'; }
       openModal(id) {
        document.getElementById(id).classList.add('active');
        // å½“å•†åº—æ‰“å¼€æ—¶ï¼ŒæŠŠHUDæåˆ°é¡¶å±‚
        if (id === 'shopModal') {
            document.querySelector('.header-group').classList.add('hud-on-top');
        }
    }

    closeModal(id) {
        document.getElementById(id).classList.remove('active');
        // å…³é—­å¼¹çª—æ—¶ï¼Œæ¢å¤HUDçš„åŸå§‹å±‚çº§
        document.querySelector('.header-group').classList.remove('hud-on-top');
    }

    toggleSettings(s){ document.getElementById('settings-drawer').classList.toggle('active',s); }
    setVolume(v){ audio.setVolume(v); }
    resetData(){ if(confirm('ç¡®å®šæ¸…ç©ºå­˜æ¡£å—ï¼Ÿ')){localStorage.clear(); location.reload();} }
}
const app = new FishingGame();
</script>
</body>
</html>